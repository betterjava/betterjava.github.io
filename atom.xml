<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Liya&#39;blog</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://liya.wiki/"/>
  <updated>2019-08-20T08:27:05.050Z</updated>
  <id>https://liya.wiki/</id>
  
  <author>
    <name>Liya</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>sharding-jdbc:原理与实现(三):线程池</title>
    <link href="https://liya.wiki/2019/08/20/shardingjdbc-threadpool/"/>
    <id>https://liya.wiki/2019/08/20/shardingjdbc-threadpool/</id>
    <published>2019-08-20T03:42:03.000Z</published>
    <updated>2019-08-20T08:27:05.050Z</updated>
    
    <summary type="html">
    
      &lt;h3 id=&quot;默认线程池大小&quot;&gt;&lt;a href=&quot;#默认线程池大小&quot; class=&quot;headerlink&quot; title=&quot;默认线程池大小&quot;&gt;&lt;/a&gt;默认线程池大小&lt;/h3&gt;&lt;p&gt;sharding-jdbc 线程池，默认Executors.newCachedThreadPool()，可以通过以下参数进行配置&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;EXECUTOR_SIZE(&amp;quot;executor.size&amp;quot;, String.valueOf(0), int.class),&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="shardingsphere" scheme="https://liya.wiki/categories/shardingsphere/"/>
    
    
      <category term="shardingsphere" scheme="https://liya.wiki/tags/shardingsphere/"/>
    
      <category term="sharding-jdbc" scheme="https://liya.wiki/tags/sharding-jdbc/"/>
    
  </entry>
  
  <entry>
    <title>sharding-jdbc:原理与实现(二):事务</title>
    <link href="https://liya.wiki/2019/08/19/shardingjdbc-transaction/"/>
    <id>https://liya.wiki/2019/08/19/shardingjdbc-transaction/</id>
    <published>2019-08-19T09:15:46.000Z</published>
    <updated>2019-08-19T13:16:29.996Z</updated>
    
    <summary type="html">
    
      &lt;h3 id=&quot;使用方法-代码方式&quot;&gt;&lt;a href=&quot;#使用方法-代码方式&quot; class=&quot;headerlink&quot; title=&quot;使用方法(代码方式)&quot;&gt;&lt;/a&gt;使用方法(代码方式)&lt;/h3&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Connection connection = null;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;try &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    // 开启本地事务，TransactionType.XA xa 事务，TransactionType.BASE base 事务&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    TransactionTypeHolder.set(TransactionType.LOCAL);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    // 通过 ShardingDataSourceFactory 创建 ShardingDatasource&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    DataSource dataSource = ShardingDataSourceFactory.createDataSource(datasourceMap, shardingRuleConfig, pros);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    // 通过 ShardingDatasource 创建 ShardingConnection&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    connection = dataSource.getConnection();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    connection.setAutoCommit(false);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    // 通过 ShardingConnection 创建 ShardingStatement&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Statement statement = connection.createStatement();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    // 执行 并返回结果，这一步完成了 创建真实Connection 变 创建 真正Statement 并执行的结果&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    statement.executeUpdate(&amp;quot;update user set name = &amp;apos;cc&amp;apos; where ex_id = 3&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    connection.commit();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    statement.close();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    connection.close();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125; catch (SQLException e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    try &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        connection.rollback();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125; catch (SQLException e1) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        e1.printStackTrace();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    e.printStackTrace();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="shardingsphere" scheme="https://liya.wiki/categories/shardingsphere/"/>
    
    
      <category term="shardingsphere" scheme="https://liya.wiki/tags/shardingsphere/"/>
    
      <category term="sharding-jdbc" scheme="https://liya.wiki/tags/sharding-jdbc/"/>
    
  </entry>
  
  <entry>
    <title>sharding-jdbc:原理与实现(一):主流程</title>
    <link href="https://liya.wiki/2019/08/19/shardingjdbc-mainprocess/"/>
    <id>https://liya.wiki/2019/08/19/shardingjdbc-mainprocess/</id>
    <published>2019-08-19T07:39:16.000Z</published>
    <updated>2019-08-19T13:13:22.812Z</updated>
    
    <summary type="html">
    
      &lt;h3 id=&quot;使用方法-代码方式&quot;&gt;&lt;a href=&quot;#使用方法-代码方式&quot; class=&quot;headerlink&quot; title=&quot;使用方法(代码方式)&quot;&gt;&lt;/a&gt;使用方法(代码方式)&lt;/h3&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;private static void testBasicUse() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Map&amp;lt;String, DataSource&amp;gt; datasourceMap = new HashMap&amp;lt;&amp;gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Properties pros = new Properties();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    // 创建真正的dataSouce&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    datasourceMap.put(&amp;quot;cookie&amp;quot;, getDbcpDatasource());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    // 创建 分表规则&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ShardingRuleConfiguration shardingRuleConfig = new ShardingRuleConfiguration();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    TableRuleConfiguration tableRuleConfiguration = new TableRuleConfiguration(&amp;quot;user&amp;quot;, &amp;quot;cookie.user_$-&amp;gt;&amp;#123;0..9&amp;#125;&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    shardingRuleConfig.getTableRuleConfigs().add(tableRuleConfiguration);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    InlineShardingStrategyConfiguration inlineShardingStrategyConfiguration = new InlineShardingStrategyConfiguration(&amp;quot;ex_id&amp;quot;, &amp;quot;user_$-&amp;gt;&amp;#123;ex_id % 10&amp;#125;&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    shardingRuleConfig.setDefaultTableShardingStrategyConfig(inlineShardingStrategyConfiguration);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    try &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        // 通过 ShardingDataSourceFactory 创建 ShardingDatasource&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        DataSource dataSource = ShardingDataSourceFactory.createDataSource(datasourceMap, shardingRuleConfig, pros);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        // 通过 ShardingDatasource 创建 ShardingConnection&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Connection connection = dataSource.getConnection();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        // 通过 ShardingConnection 创建 ShardingStatement&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Statement statement = connection.createStatement();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        // 执行 并返回结果，这一步完成了 创建真实Connection 变 创建 真正Statement 并执行的结果&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ResultSet rs = statement.executeQuery(&amp;quot;select * from user&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        while (rs.next()) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            StringBuffer sb = new StringBuffer();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            sb.append(rs.getLong(&amp;quot;id&amp;quot;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            sb.append(&amp;quot;,&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            sb.append(rs.getString(&amp;quot;name&amp;quot;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            sb.append(&amp;quot;,&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            sb.append(rs.getLong(&amp;quot;ex_id&amp;quot;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            System.out.println(sb.toString());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        rs.close();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        statement.close();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        connection.close();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125; catch (SQLException e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        e.printStackTrace();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="shardingsphere" scheme="https://liya.wiki/categories/shardingsphere/"/>
    
    
      <category term="shardingsphere" scheme="https://liya.wiki/tags/shardingsphere/"/>
    
      <category term="sharding-jdbc" scheme="https://liya.wiki/tags/sharding-jdbc/"/>
    
  </entry>
  
</feed>
